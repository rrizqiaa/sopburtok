<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Production - SOP BURTOK</title>
  <link rel="stylesheet" href="assets/css/style.css" />
  <style>
  @media (max-width: 768px) {
    .flex-container {
      flex-direction: column !important;
    }
  }
</style>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f0f0f0;
    }
    .dashboard-wrapper {
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 250px;
      background-color: #2c3e50;
      color: white;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .sidebar img {
      width: 100px;
      margin-bottom: 20px;
    }
    .sidebar h3 {
      margin-bottom: 20px;
    }
    .menu-btn {
      background-color: #34495e;
      color: white;
      border: none;
      padding: 10px 15px;
      margin-bottom: 10px;
      cursor: pointer;
      width: 100%;
    }
    .menu-btn.active {
      background-color: #1abc9c;
    }
    .top-bar {
      background-color: #ecf0f1;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .content {
      flex-grow: 1;
      padding: 20px;
    }
    .stock-table {
      width: 100%;
      border-collapse: collapse;
    }
    .stock-table th, .stock-table td {
      border: 1px solid #ddd;
      padding: 8px;
    }
    .stock-table th {
      background-color: #2c3e50;
      color: white;
    }
    .dark-mode {
      background-color: #2c3e50 !important; 
      color: white !important; 
    }
  </style>
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
  <div class="dashboard-wrapper">
    <!-- Sidebar -->
    <div class="sidebar">
      <img src="assets/images/logo.png" alt="SOP BURTOK" />
      <h3>SOP BURTOK</h3>
      <button class="menu-btn" onclick="location.href='dashboard.html'">Home</button>
      <button class="menu-btn" onclick="location.href='inventory.html'">Inventory</button>
      <button class="menu-btn active" onclick="location.href='production.html'">Production</button>
      <button class="menu-btn" onclick="location.href='reporting.html'">Reporting</button>
      <button class="menu-btn" onclick="location.href='profile.html'">Profile</button>

    </div>

    <!-- Top Bar -->
    <div class="top-bar">
      <div id="liveClock" style="margin-right: 15px; font-weight: bold;"></div>
      <button class="toggle-mode-btn" onclick="toggleMode()" style="margin-right: 10px;">ðŸŒ“</button>
      <button class="logout-btn" onclick="logoutUser()">Logout</button>
    </div>

    <!-- Main Content -->
    <div class="content">
      
      <h2>Production - Penggunaan Bahan Baku</h2>
<!-- Flex Container -->
<div class="flex-container" style="display: flex; gap: 20px; margin-bottom: 20px;">
  <!-- Gunakan Bahan Baku -->
  <div style="flex: 1; background-color: #e7f7e6; padding: 15px; border-radius: 5px;">
    <h4>Gunakan Bahan Baku</h4>
    <select id="selectBahan">
      <option>-- Pilih Bahan Baku --</option>
    </select>
    <input id="jumlah" type="number" placeholder="Jumlah yang Digunakan" />
    <button id="btnGunakan">Gunakan</button>
  </div>

  <!-- Kalkulator Berat per Porsi -->
  <div style="flex: 1; background-color: #e7f7e6; padding: 15px; border-radius: 5px;">
    <h4>Kalkulator Berat per Porsi</h4>
    <input id="beratDaging" type="number" placeholder="Berat Daging (kg)" style="margin-bottom: 5px;" /><br />
    <input id="trimming" type="number" placeholder="Susut karena Trimming (gram)" style="margin-bottom: 5px;" /><br />
    <input id="susutMasak" type="number" placeholder="Susut karena Masak (%)" style="margin-bottom: 5px;" /><br />
    <input id="jumlahMangkok" type="number" placeholder="Jumlah Mangkuk yang Diinginkan" style="margin-bottom: 10px;" /><br />
    <button onclick="hitungBeratPerMangkok()">Hitung Berat per Mangkok</button>
    <p id="hasilKalkulator" style="margin-top: 10px; font-weight: bold;"></p>
  </div>
</div>
      <!-- Script Kalkulator -->
<script>
  function hitungBeratPerMangkok() {
    const beratDaging = parseFloat(document.getElementById("beratDaging").value) * 1000; // dari kg ke gram
    const trimming = parseFloat(document.getElementById("trimming").value);
    const susutMasak = parseFloat(document.getElementById("susutMasak").value);
    const jumlahMangkok = parseInt(document.getElementById("jumlahMangkok").value);

    if (isNaN(beratDaging) || isNaN(trimming) || isNaN(susutMasak) || isNaN(jumlahMangkok) || jumlahMangkok <= 0) {
      document.getElementById("hasilKalkulator").textContent = "Mohon isi semua kolom dengan benar.";
      return;
    }

    const setelahTrimming = beratDaging - trimming;
    const setelahMasak = setelahTrimming - (susutMasak / 100 * setelahTrimming);
    const beratPerMangkok = setelahMasak / jumlahMangkok;

    document.getElementById("hasilKalkulator").textContent = 
      `Berat per mangkok: ${beratPerMangkok.toFixed(2)} gram`;
  }
</script>

      <!-- Tabel stok -->
      <table class="stock-table">
        <thead>
          <tr>
            <th>Nama</th>
            <th>Kategori</th>
            <th>Tanggal Masuk</th>
            <th>Jumlah Tersedia</th>
          </tr>
        </thead>
        <tbody id="stockTableBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Clock -->
  <script>
    function updateLiveClock() {
      const el = document.getElementById("liveClock");
      const days = ['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];
      const months = ['Januari','Februari','Maret','April','Mei','Juni',
                      'Juli','Agustus','September','Oktober','November','Desember'];
      const now = new Date();
      el.textContent = `${days[now.getDay()]}, ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()} - ${now.toLocaleTimeString('id-ID')}`;
    }
    setInterval(updateLiveClock, 1000);
    updateLiveClock();
  </script>

  <!-- Theme -->
  <script>
    function toggleMode() {
      const isDark = document.body.classList.toggle("dark-mode");
      localStorage.setItem("theme", isDark ? "dark" : "light");
    }

    document.addEventListener("DOMContentLoaded", () => {
      if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark-mode");
      }
    });
  </script>

  <!-- Data Stok -->
  <script>
    const token = localStorage.getItem("token");
    if (!token) window.location.href = "index.html";

    async function loadStock() {
      try {
        const res = await fetch("https://api.sopburtok.giize.com/api/inventory", {
          headers: { Authorization: `Bearer ${token}`, Accept: "application/json" }
        });
        const data = await res.json();
        renderStockTable(data);
        renderDropdown(data);
      } catch (err) {
        console.error("Gagal memuat data:", err);
        document.getElementById("stockTableBody").innerHTML = "<tr><td colspan='4'>Gagal memuat data.</td></tr>";
      }
    }

    function renderStockTable(data) {
      const tbody = document.getElementById("stockTableBody");
      tbody.innerHTML = "";

      data.forEach(item => {
        const row = document.createElement("tr");
        const nameLower = item.name?.toLowerCase() || "";
        const unit = (nameLower === "air" || nameLower === "minyak") ? "Liter" : "Kg";

        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.category}</td>
          <td>${item.entry_date}</td>
          <td>${item.stock} ${unit}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function renderDropdown(data) {
      const select = document.getElementById("selectBahan");
      data.forEach(item => {
        const option = document.createElement("option");
        option.value = item.id;
        option.textContent = item.name;
        select.appendChild(option);
      });
    }

    loadStock();
  </script>
  <script>
document.getElementById("btnGunakan").addEventListener("click", gunakanBahanBaku);

  async function gunakanBahanBaku() {
    const bahanId = document.getElementById("selectBahan").value;
    const jumlah = document.getElementById("jumlah").value;

    if (!bahanId || !jumlah || jumlah <= 0) {
      alert("Pilih bahan baku dan masukkan jumlah yang valid.");
      return;
    }

    try {
      const res = await fetch("https://api.sopburtok.giize.com/api/production/use", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${token}`,
          "Accept": "application/json",
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          bahan_id: bahanId,
          jumlah: jumlah
        })
      });

      const result = await res.json();

      if (!res.ok) {
        alert("Gagal menggunakan bahan: " + result.message);
        return;
      }

      alert("Bahan berhasil digunakan!");
      loadStock(); // refresh data stok

    } catch (error) {
      console.error("Terjadi kesalahan:", error);
      alert("Terjadi kesalahan saat memproses permintaan.");
    }
  }
</script>


  <!-- Logout -->
  <script>
    function logoutUser() {
      fetch("https://api.sopburtok.giize.com/api/logout", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${token}`,
          "Accept": "application/json"
        }
      }).finally(() => {
        localStorage.clear();
        window.location.href = "index.html";
      });
    }
  </script>
</body>
</html>