<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon" />
  <title>Production - SOP BURTOK</title>
  <link rel="stylesheet" href="assets/css/style.css" />
  <style>
    .grid-wrapper {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .card {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
    }
    .card h3 {
      text-align: center;
    }
    .card input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
    .card button {
      width: 100%;
      background-color: #27ae60;
      color: white;
      padding: 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .result {
      margin-top: 10px;
      background-color: #ecf0f1;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="dashboard-wrapper">
    <!-- Sidebar -->
    <div class="sidebar">
      <img src="assets/images/Logo Sop Burtok Ori.png" alt="SOP BURTOK" />
      <h3>SOP BURTOK</h3>
      <button class="menu-btn" onclick="location.href='dashboard.html'">Home</button>
      <button class="menu-btn" onclick="location.href='inventory.html'">Inventory</button>
      <button class="menu-btn active" onclick="location.href='production.html'">Production</button>
      <button class="menu-btn" onclick="location.href='reporting.html'">Reporting</button>
      <button class="menu-btn" onclick="location.href='profile.html'">Profile</button>
    </div>

    <!-- Top tools -->
    <div id="top-tools">
      <div id="liveClock" style="font-weight: bold;"></div>
      <button class="toggle-mode-btn" onclick="toggleMode()">ðŸŒ“</button>
      <button class="logout-btn" onclick="logoutUser()">Logout</button>
    </div>

    <!-- Content -->
    <div class="content">
      <h2>Produksi - Perhitungan Pemakaian Daging</h2>
      <div class="grid-wrapper">
        <!-- Kasir -->
        <div class="card">
          <h3>Daging Terpakai Kasir</h3>
          <label>Sop Komplit (40gr):</label>
          <input type="number" id="sopKomplit" />
          <label>Sop Reguler (40gr):</label>
          <input type="number" id="sopReguler" />
          <label>Sop Kecil (20gr):</label>
          <input type="number" id="sopKecil" />
          <label>Dry Komplit (45gr):</label>
          <input type="number" id="dryKomplit" />
          <label>Dry Reguler (45gr):</label>
          <input type="number" id="dryReguler" />
          <label>Dry Kecil (25gr):</label>
          <input type="number" id="dryKecil" />
          <label>Extra Daging (20gr):</label>
          <input type="number" id="extraDaging" />
          <label>Extra Dry (25gr):</label>
          <input type="number" id="extraDry" />
          <button onclick="hitungDagingKasir()">Hitung Daging Kasir</button>
          <div class="result" id="hasilKasir">Daging Terpakai Kasir: - gr</div>
        </div>

        <!-- Stok -->
        <div class="card">
          <h3>Daging Terpakai Stok</h3>
          <label>Daging Opening (gr):</label>
          <input type="number" id="opening" />
          <label>Daging Penambahan (gr):</label>
          <input type="number" id="penambahan" />
          <label>Daging Closing (gr):</label>
          <input type="number" id="closing" />
          <button onclick="hitungDagingStok()">Hitung Daging Stok</button>
          <div class="result" id="hasilStok">Daging Terpakai Stok: - gr</div>
        </div>

        <!-- Selisih -->
        <div class="card">
          <h3>Selisih Total</h3>
          <label>Daging Terpakai Kasir (B):</label>
          <input type="number" id="kasirTerpakai" />
          <label>Daging Terpakai Stok (A):</label>
          <input type="number" id="stokTerpakai" />
          <button onclick="hitungSelisihManual()">Hitung Selisih Total (C)</button>
          <div class="result" id="hasilSelisihManual">Selisih Total: - gr</div>
        </div>

        <!-- Persentase -->
        <div class="card">
          <h3>Persentase Selisih</h3>
          <label>Selisih Total (gr):</label>
          <input type="number" id="selisihPersen" />
          <label>Daging Terpakai Kasir (gr):</label>
          <input type="number" id="kasirTotal" />
          <button onclick="hitungPersentase()">Hitung Persentase</button>
          <div class="result" id="hasilPersentase">Persentase Selisih: - %</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Script tetap -->
  <script>
    const token = localStorage.getItem("token");
    if (!token) window.location.href = "index.html";
    const user = JSON.parse(localStorage.getItem("user") || "{}");

    function updateLiveClock() {
      const el = document.getElementById("liveClock");
      const days = ['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];
      const months = ['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];
      const now = new Date();
      el.textContent = `${days[now.getDay()]}, ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()} - ${now.toLocaleTimeString('id-ID')}`;
    }
    setInterval(updateLiveClock, 1000);
    updateLiveClock();

    function toggleMode() {
      const isDark = document.body.classList.toggle("dark-mode");
      localStorage.setItem("theme", isDark ? "dark" : "light");
    }

    function logoutUser() {
      fetch("https://api.sopburtok.giize.com/api/logout", {
        method: "POST",
        headers: { "Authorization": `Bearer ${token}`, "Accept": "application/json" }
      }).finally(() => {
        localStorage.clear();
        window.location.href = "index.html";
      });
    }

    function hitungDagingKasir() {
      const get = id => parseFloat(document.getElementById(id).value) || 0;
      const totalKasir = get("sopKomplit") * 40 + get("sopReguler") * 40 + get("sopKecil") * 20 +
                         get("dryKomplit") * 45 + get("dryReguler") * 45 + get("dryKecil") * 25 +
                         get("extraDaging") * 20 + get("extraDry") * 25;
      document.getElementById("hasilKasir").innerText = `Daging Terpakai Kasir: ${totalKasir} gr`;
      document.getElementById("kasirTerpakai").value = totalKasir;
      document.getElementById("kasirTotal").value = totalKasir;
    }

    function hitungDagingStok() {
      const opening = parseFloat(document.getElementById("opening").value) || 0;
      const penambahan = parseFloat(document.getElementById("penambahan").value) || 0;
      const closing = parseFloat(document.getElementById("closing").value) || 0;
      const totalStok = opening + penambahan - closing;
      document.getElementById("hasilStok").innerText = `Daging Terpakai Stok: ${totalStok} gr`;
      document.getElementById("stokTerpakai").value = totalStok;
    }

    function hitungSelisihManual() {
      const b = parseFloat(document.getElementById("kasirTerpakai").value) || 0;
      const a = parseFloat(document.getElementById("stokTerpakai").value) || 0;
      const c = b - a;
      document.getElementById("hasilSelisihManual").innerText = `Selisih Total: ${c} gr`;
      document.getElementById("selisihPersen").value = c;
    }

    function hitungPersentase() {
      const selisih = parseFloat(document.getElementById("selisihPersen").value) || 0;
      const totalKasir = parseFloat(document.getElementById("kasirTotal").value) || 0;
      if (totalKasir === 0) {
        document.getElementById("hasilPersentase").innerText = "Persentase Selisih: tidak dapat dihitung (kasir = 0)";
        return;
      }
      const persen = (selisih / totalKasir) * 100;
      document.getElementById("hasilPersentase").innerText = `Persentase Selisih: ${persen.toFixed(2)} %`;
    }
  </script>
</body>
</html>