<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Production - SOP BURTOK</title>
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
  <div class="dashboard-wrapper">
    <!-- Sidebar -->
    <div class="sidebar">
      <img src="assets/images/logo.png" alt="SOP BURTOK" />
      <h3>SOP BURTOK</h3>
      <button class="menu-btn" onclick="location.href='dashboard.html'">Home</button>
      <button class="menu-btn" onclick="location.href='inventory.html'">Inventory</button>
      <button class="menu-btn active" onclick="location.href='production.html'">Production</button>
      <button class="menu-btn" onclick="location.href='reporting.html'">Reporting</button>
      <button class="menu-btn" onclick="location.href='profile.html'">Profile</button>
    </div>

    <!-- Top Bar -->
    <div class="top-bar">
      <div id="liveClock" style="margin-right: 15px; font-weight: bold;"></div>
      <button class="toggle-mode-btn" onclick="toggleMode()" style="margin-right: 10px;">ðŸŒ“</button>
      <button class="logout-btn" onclick="logoutUser()">Logout</button>
    </div>

    <!-- Main Content -->
    <div class="content">
      
      <h2>Production - Penggunaan Bahan Baku</h2>

      <!-- Form penggunaan -->
      <div style="background-color: #e7f7e6; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
        <h4>Gunakan Bahan Baku</h4>
        <select id="selectBahan">
          <option>-- Pilih Bahan Baku --</option>
        </select>
        <input id="jumlahDigunakan" type="number" placeholder="Jumlah yang Digunakan" />
        <button>Gunakan</button>
      </div>

      <!-- Tabel stok -->
      <table class="stock-table">
        <thead>
          <tr>
            <th>Nama</th>
            <th>Kategori</th>
            <th>Tanggal Masuk</th>
            <th>Jumlah Tersedia</th>
          </tr>
        </thead>
        <tbody id="stockTableBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Clock -->
  <script>
    function updateLiveClock() {
      const el = document.getElementById("liveClock");
      const days = ['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];
      const months = ['Januari','Februari','Maret','April','Mei','Juni',
                      'Juli','Agustus','September','Oktober','November','Desember'];
      const now = new Date();
      el.textContent = `${days[now.getDay()]}, ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()} - ${now.toLocaleTimeString('id-ID')}`;
    }
    setInterval(updateLiveClock, 1000);
    updateLiveClock();
  </script>

  <!-- Theme -->
  <script>
    function toggleMode() {
      const isDark = document.body.classList.toggle("dark-mode");
      localStorage.setItem("theme", isDark ? "dark" : "light");
    }

    document.addEventListener("DOMContentLoaded", () => {
      if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark-mode");
      }
    });
  </script>

  <!-- Data Stok -->
  <script>
    const token = localStorage.getItem("token");
    if (!token) window.location.href = "index.html";

    async function loadStock() {
      try {
        const res = await fetch("https://api.sopburtok.giize.com/api/inventory", {
          headers: { Authorization: `Bearer ${token}`, Accept: "application/json" }
        });
        const data = await res.json();
        renderStockTable(data);
        renderDropdown(data);
      } catch (err) {
        console.error("Gagal memuat data:", err);
        document.getElementById("stockTableBody").innerHTML = "<tr><td colspan='4'>Gagal memuat data.</td></tr>";
      }
    }

    function renderStockTable(data) {
      const tbody = document.getElementById("stockTableBody");
      tbody.innerHTML = "";

      data.forEach(item => {
        const row = document.createElement("tr");
        const nameLower = item.name?.toLowerCase() || "";
        const unit = (nameLower === "air" || nameLower === "minyak") ? "Liter" : "Kg";

        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.category}</td>
          <td>${item.entry_date}</td>
          <td>${item.stock} ${unit}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function renderDropdown(data) {
      const select = document.getElementById("selectBahan");
      data.forEach(item => {
        const option = document.createElement("option");
        option.value = item.id;
        option.textContent = item.name;
        select.appendChild(option);
      });
    }

    loadStock();
  </script>

  <!-- Logout -->
  <script>
    function logoutUser() {
      fetch("https://api.sopburtok.giize.com/api/logout", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${token}`,
          "Accept": "application/json"
        }
      }).finally(() => {
        localStorage.clear();
        window.location.href = "index.html";
      });
    }
  </script>
</body>
</html>
